/*============================================================================*\

	JavaScript by Brian Sexton for the Williams Sonoma Coding Challenge

	------------------------------------------------------------------------

	Brian Sexton - https://briansexton.com/

	Main Portfolio - https://brian.works/

	Writing Portfolio - https://wellwritten.work/

	Résumé and Supplemental Documents - https://brian.works/resume

	------------------------------------------------------------------------

	Please Note: This is work in progress and not yet feature-complete!

\*============================================================================*/
class Utilities{static isModernBrowser(){return!!(globalThis&&window&&window.fetch)}static formatPrice(e){return new Intl.NumberFormat("us-EN",{style:"currency",currency:"USD"}).format(e)}}class ProductGallery{constructor(e){this.feedUrl=e,this.loadedData,this.feedUrl&&this.loadFeed(this.feedUrl).then(e=>{this.loadedData=e,this.showProductMenu(this.loadedData.groups)})}addOverlay(){let e=document.getElementById("overlay-template").content.cloneNode(!0).querySelector(".overlay");return e.querySelector(".backdrop").addEventListener("click",()=>{e.remove()}),document.body.appendChild(e),e}buildProductBrowser(e){let t,r,i=document.getElementById("product-browser-template").content.cloneNode(!0).querySelector(".product-browser"),l=i.querySelector("header .product-image"),o=i.querySelector("header .product-name"),a=i.querySelector("header .close-button"),n=i.querySelector(".body .product-image"),c=i.querySelector(".body .product-price"),s=i.querySelector(".body .product-images");l.setAttribute("src",e.hero.href),l.setAttribute("alt",e.hero.alt||e.name),l.addEventListener("click",()=>{n.setAttribute("src",e.hero.href),n.setAttribute("alt",e.hero.alt||e.name),n.setAttribute("width",e.hero.width),n.setAttribute("height",e.hero.height)}),o.textContent=e.name,a.addEventListener("click",()=>{let e=i.closest(".overlay");e&&e.remove()}),n.setAttribute("src",e.hero.href),n.setAttribute("alt",e.hero.alt||e.name),n.setAttribute("width",e.hero.width),n.setAttribute("height",e.hero.height),e.price?c.textContent="regularly "+Utilities.formatPrice(e.price.regular)+", currently "+Utilities.formatPrice(e.price.selling)+", "+e.price.type:e.priceRange?c.textContent="regularly "+Utilities.formatPrice(e.priceRange.regular.low)+" to "+Utilities.formatPrice(e.priceRange.regular.high)+", currently "+Utilities.formatPrice(e.priceRange.selling.low)+" to "+Utilities.formatPrice(e.priceRange.selling.high)+", "+e.priceRange.type:c.textContent="to be announced";for(let i=0;i<e.images.length;i++)t=document.createElement("li"),r=document.createElement("img"),r.setAttribute("src",e.images[i].href),r.setAttribute("alt",e.images[i].alt||e.name),r.setAttribute("width",e.images[i].width),r.setAttribute("height",e.images[i].height),r.addEventListener("click",()=>{n.setAttribute("src",e.images[i].href),n.setAttribute("alt",e.images[i].alt||e.name),n.setAttribute("width",e.images[i].width),n.setAttribute("height",e.images[i].height)}),t.appendChild(r),s.appendChild(t);let u=i.querySelector(".body .product-page-link a");return e.links&&e.links.www?(u.setAttribute("href",e.links.www),u.setAttribute("title",e.name)):u.parentElement.remove(),i}hideProductMenu(e){let t=document.getElementById("product-menu");!0===e&&this.clearProductMenu(),t.style.display="none"}buildProductMenu(e){let t=document.getElementById("product-menu").querySelector(".products"),r=t.querySelector("template");e.forEach(e=>{let i=r.content.cloneNode(!0),l=i.querySelector(".product-image");l.setAttribute("src",e.hero.href),l.setAttribute("width",e.hero.width),l.setAttribute("height",e.hero.height),l.setAttribute("alt",e.alt||e.name),l.setAttribute("title",e.name),l.addEventListener("click",()=>this.showProduct(e)),i.querySelector(".product-name").textContent=e.name;let o=i.querySelector(".regular-price"),a=i.querySelector(".current-price"),n=e.price&&"special"===e.price.type||e.priceRange&&"special"===e.priceRange.type;if(e.price&&e.price.regular){let t=n?"<del>":"",r=n?"</del>":"";o.innerHTML=t+Utilities.formatPrice(e.price.regular)+r}else if(e.priceRange&&e.priceRange.regular&&e.priceRange.regular.low&&e.priceRange.regular.high){let t=n?"<del>":"",r=n?"</del>":"";o.innerHTML=t+Utilities.formatPrice(e.priceRange.regular.low)+"–"+Utilities.formatPrice(e.priceRange.regular.high)+r}else o.remove();e.price&&e.price.selling?a.textContent=Utilities.formatPrice(e.price.selling):e.priceRange&&e.priceRange.selling&&e.priceRange.selling.low&&e.priceRange.selling.high?a.textContent=Utilities.formatPrice(e.priceRange.selling.low)+"–"+Utilities.formatPrice(e.priceRange.selling.high):a.remove();let c=i.querySelector(".product-card .product-page-link a");e.links&&e.links.www?(c.setAttribute("href",e.links.www),c.setAttribute("title",e.name)):c.parentElement.remove(),t.appendChild(i)})}clearProductMenu(){document.querySelectorAll("#product-menu .products li").forEach(e=>{e.parentElement.removeChild(e)})}async loadFeed(e){try{let t=await fetch(e);if(200===t.status)return console.log("[loadFeed] HTTP Status: 200 OK. Returning JSON."),await t.json();console.log("[loadFeed] Uh oh. The fetch request did not return with the expected HTTP status (200)."),console.log("[loadFeed] HTTP Status: "+t.status),console.log("[loadFeed] HTTP Status Text: "+t.statusText)}catch(e){console.log(e)}}showProduct(e){let t=this.addOverlay();t.classList.add("product-image-overlay");let r=this.buildProductBrowser(e);t.querySelector(".content").appendChild(r)}showProductMenu(e){let t=document.getElementById("product-menu");0===t.querySelectorAll(".products > li").length&&this.buildProductMenu(e),t.style.display="block"}}const FEED_URL="https://bdsexton.github.io/williams-sonoma-coding-challenge/_assets/data/products.json";Utilities.isModernBrowser()?new ProductGallery(FEED_URL):alert("Sorry, but this app requires a modern web browser. Please open it in a recent version of something like Chrome, Firefox, Opera, Edge, or Safari instead.");