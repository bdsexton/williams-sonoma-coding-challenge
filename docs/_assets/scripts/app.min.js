/*============================================================================*\

	JavaScript by Brian Sexton for the Williams Sonoma Coding Challenge

	------------------------------------------------------------------------

	Brian Sexton - https://briansexton.com/

	Main Portfolio - https://brian.works/

	Writing Portfolio - https://wellwritten.work/

	Résumé and Supplemental Documents - https://brian.works/resume

	------------------------------------------------------------------------

	Please Note: This is work in progress and not yet feature-complete!

\*============================================================================*/
class Utilities{static isModernBrowser(){return!!(globalThis&&window&&window.fetch)}static formatPrice(e){return new Intl.NumberFormat("us-EN",{style:"currency",currency:"USD"}).format(e)}}class ProductGallery{constructor(e){this.feedUrl=e,this.loadedData,this.feedUrl&&this.loadFeed(this.feedUrl).then(e=>{this.loadedData=e,this.showProductMenu(this.loadedData.groups)})}addOverlay(){let e=document.getElementById("overlay-template").content.cloneNode(!0).querySelector(".overlay");return e.querySelector(".backdrop").addEventListener("click",()=>{e.remove()}),document.body.appendChild(e),e}buildProductBrowser(e){let t,r,i=document.getElementById("product-browser-template").content.cloneNode(!0).querySelector(".product-browser"),l=i.querySelector("header .product-image"),o=i.querySelector("header .product-name"),a=i.querySelector("header .close-button"),s=i.querySelector(".body .product-image"),n=i.querySelector(".body .product-images");l.setAttribute("src",e.hero.href),l.setAttribute("alt",e.hero.alt||e.name),l.addEventListener("click",()=>{s.setAttribute("src",e.hero.href),s.setAttribute("alt",e.hero.alt||e.name),s.setAttribute("width",e.hero.width),s.setAttribute("height",e.hero.height)}),o.textContent=e.name,a.addEventListener("click",()=>{let e=i.closest(".overlay");e&&e.remove()}),s.setAttribute("src",e.hero.href),s.setAttribute("alt",e.hero.alt||e.name),s.setAttribute("width",e.hero.width),s.setAttribute("height",e.hero.height),this.updatePriceElements(i.querySelector(".body"),e);for(let i=0;i<e.images.length;i++)t=document.createElement("li"),r=document.createElement("img"),r.setAttribute("src",e.images[i].href),r.setAttribute("alt",e.images[i].alt||e.name),r.setAttribute("width",e.images[i].width),r.setAttribute("height",e.images[i].height),r.addEventListener("click",()=>{s.setAttribute("src",e.images[i].href),s.setAttribute("alt",e.images[i].alt||e.name),s.setAttribute("width",e.images[i].width),s.setAttribute("height",e.images[i].height)}),t.appendChild(r),n.appendChild(t);let c=i.querySelector(".body .product-page-link a");return e.links&&e.links.www?(c.setAttribute("href",e.links.www),c.setAttribute("title",e.name)):c.parentElement.remove(),i}hideProductMenu(e){let t=document.getElementById("product-menu");!0===e&&this.clearProductMenu(),t.style.display="none"}buildProductMenu(e){let t=document.getElementById("product-menu").querySelector(".products"),r=t.querySelector("template");e.forEach(e=>{let i=r.content.cloneNode(!0),l=i.querySelector(".product-image");l.setAttribute("src",e.hero.href),l.setAttribute("width",e.hero.width),l.setAttribute("height",e.hero.height),l.setAttribute("alt",e.alt||e.name),l.setAttribute("title",e.name),l.addEventListener("click",()=>this.showProduct(e)),i.querySelector(".product-name").textContent=e.name,this.updatePriceElements(i,e);let o=i.querySelector(".product-card .product-page-link a");e.links&&e.links.www?(o.setAttribute("href",e.links.www),o.setAttribute("title",e.name)):o.parentElement.remove(),t.appendChild(i)})}clearProductMenu(){document.querySelectorAll("#product-menu .products li").forEach(e=>{e.parentElement.removeChild(e)})}async loadFeed(e){try{let t=await fetch(e);if(200===t.status)return console.log("[loadFeed] HTTP Status: 200 OK. Returning JSON."),await t.json();console.log("[loadFeed] Uh oh. The fetch request did not return with the expected HTTP status (200)."),console.log("[loadFeed] HTTP Status: "+t.status),console.log("[loadFeed] HTTP Status Text: "+t.statusText)}catch(e){console.log(e)}}showProduct(e){let t=this.addOverlay();t.classList.add("product-image-overlay");let r=this.buildProductBrowser(e);t.querySelector(".content").appendChild(r)}showProductMenu(e){let t=document.getElementById("product-menu");0===t.querySelectorAll(".products > li").length&&this.buildProductMenu(e),t.style.display="block"}updatePriceElements(e,t){let r=e.querySelector(".regular-price"),i=e.querySelector(".current-price"),l=t.price&&"special"===t.price.type||t.priceRange&&"special"===t.priceRange.type;if(t.price&&t.price.regular){let e=l?"<del>":"",i=l?"</del>":"";r.innerHTML=e+Utilities.formatPrice(t.price.regular)+i}else if(t.priceRange&&t.priceRange.regular&&t.priceRange.regular.low&&t.priceRange.regular.high){let e=l?"<del>":"",i=l?"</del>":"";r.innerHTML=e+Utilities.formatPrice(t.priceRange.regular.low)+"–"+Utilities.formatPrice(t.priceRange.regular.high)+i}else r.remove();t.price&&t.price.selling?i.textContent=Utilities.formatPrice(t.price.selling):t.priceRange&&t.priceRange.selling&&t.priceRange.selling.low&&t.priceRange.selling.high?i.textContent=Utilities.formatPrice(t.priceRange.selling.low)+"–"+Utilities.formatPrice(t.priceRange.selling.high):i.remove()}}const FEED_URL="https://bdsexton.github.io/williams-sonoma-coding-challenge/_assets/data/products.json";Utilities.isModernBrowser()?new ProductGallery(FEED_URL):alert("Sorry, but this app requires a modern web browser. Please open it in a recent version of something like Chrome, Firefox, Opera, Edge, or Safari instead.");