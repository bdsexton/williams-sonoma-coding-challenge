/*============================================================================*\

	JavaScript by Brian Sexton for the Williams Sonoma Coding Challenge

	------------------------------------------------------------------------

	Brian Sexton - https://briansexton.com/

	Main Portfolio - https://brian.works/

	Writing Portfolio - https://wellwritten.work/

	Résumé and Supplemental Documents - https://brian.works/resume

	------------------------------------------------------------------------

	Please Note: This is work in progress and not yet feature-complete!

\*============================================================================*/
class Utilities{static isModernBrowser(){return!!(globalThis&&window&&window.fetch)}static formatPrice(e){return new Intl.NumberFormat("us-EN",{style:"currency",currency:"USD"}).format(e)}}class ProductGallery{constructor(e){this.feedUrl=e,this.fileInputElement=document.getElementById("file-input"),this.fileInputForm=document.getElementById("file-input-form"),this.loadedData,this.resetButton=document.getElementById("file-input-reset"),this.fileInputElement.addEventListener("change",e=>{this.handleFileInput(e)}),this.resetButton.addEventListener("click",()=>{this.handleResetButtonClick()}),this.feedUrl&&this.loadFeed(this.feedUrl).then(e=>{this.loadedData=e,this.displayRawJSON(e),this.displayProductInfo(this.loadedData.groups[0])})}clearRawJSON(){document.getElementById("raw-data").textContent=""}displayProductInfo(e){let t,i,r=document.getElementById("product-browser"),a=r.querySelector("template").content.cloneNode(!0),l=a.querySelector(".product-id"),o=a.querySelector(".product-image"),n=a.querySelector(".product-info"),s=a.querySelector(".product-name"),d=a.querySelector(".product-price"),c=a.querySelector(".product-images"),u=a.querySelector(".product-url");o.setAttribute("src",e.hero.href),o.setAttribute("alt",e.alt||e.name),o.setAttribute("width",e.width),o.setAttribute("height",e.height),l.textContent=e.id,s.textContent=e.name,n.textContent="number of images: "+e.images.length,d.textContent="regularly "+Utilities.formatPrice(e.price.regular)+", currently "+Utilities.formatPrice(e.price.selling)+", "+e.price.type,u.textContent=e.links.www;for(let r=0;r<e.images.length;r++)t=document.createElement("li"),i=document.createElement("img"),i.setAttribute("src",e.images[r].href),i.setAttribute("alt",e.images[r].alt||e.name),i.setAttribute("width",e.images[r].width),i.setAttribute("height",e.images[r].height),t.appendChild(i),c.appendChild(t);r.appendChild(a)}displayRawJSON(e){"string"==typeof e?(console.log("[displayRawJSON] String received. Displaying unaltered."),document.getElementById("raw-data").textContent=e):"object"==typeof e?(console.log("[displayRawJSON] Object received. Displaying stringified version."),document.getElementById("raw-data").textContent=JSON.stringify(e)):document.getElementById("raw-data").textContent="Uh oh! There seems to be a problem with the data, so it could not be displayed. Sorry about that!"}handleFileInput(e){console.log("[handleFileInput] FileList length: "+e.target.files.length),e.target.files.length>0&&this.readFile(e.target.files[0])}handleResetButtonClick(){this.reset()}async loadFeed(e){try{let t=await fetch(e);if(200===t.status)return console.log("[loadFeed] HTTP Status: 200 OK. Returning JSON."),await t.json();console.log("[loadFeed] Uh oh. The fetch request did not return with the expected HTTP status (200)."),console.log("[loadFeed] HTTP Status: "+t.status),console.log("[loadFeed] HTTP Status Text: "+t.statusText)}catch(e){console.log(e)}}readFile(e){let t=new FileReader;t.onload=e=>{this.loadedData=JSON.parse(e.target.result),this.displayRawJSON(e.target.result),this.displayProductInfo(this.loadedData.groups[0])},t.readAsText(e)}reset(){this.loadedData=null,this.clearRawJSON()}}const FEED_URL="https://bdsexton.github.io/williams-sonoma-coding-challenge/_assets/data/products.json";Utilities.isModernBrowser()?new ProductGallery(FEED_URL):alert("Sorry, but this app requires a modern web browser. Please open it in a recent version of something like Chrome, Firefox, Opera, Edge, or Safari instead.");