/*============================================================================*\

	JavaScript by Brian Sexton for the Williams Sonoma Coding Challenge

	------------------------------------------------------------------------

	Brian Sexton - https://briansexton.com/

	Main Portfolio - https://brian.works/

	Writing Portfolio - https://wellwritten.work/

	Résumé and Supplemental Documents - https://brian.works/resume

	------------------------------------------------------------------------

	Please Note: This is work in progress and not yet feature-complete!

\*============================================================================*/
class Utilities{static isModernBrowser(){return!!(globalThis&&window&&window.fetch)}static formatPrice(e){return new Intl.NumberFormat("us-EN",{style:"currency",currency:"USD"}).format(e)}}class ProductGallery{constructor(e){this.feedUrl=e,this.loadedData,this.feedUrl&&this.loadFeed(this.feedUrl).then(e=>{this.loadedData=e,this.showProductMenu(this.loadedData.groups)})}buildProductMenu(e){let t=document.getElementById("product-menu").querySelector(".products"),r=t.querySelector("template");e.forEach(e=>{let o=r.content.cloneNode(!0),i=o.querySelector(".product-image");i.setAttribute("src",e.hero.href),i.setAttribute("width",e.hero.width),i.setAttribute("height",e.hero.height),i.setAttribute("alt",e.alt||e.name),i.setAttribute("title",e.name),i.addEventListener("click",()=>this.showProduct(e)),t.appendChild(o)})}clearProductBrowser(){document.querySelectorAll("#product-browser .product").forEach(e=>{e.parentElement.removeChild(e)})}clearProductMenu(){document.querySelectorAll("#product-menu .products li").forEach(e=>{e.parentElement.removeChild(e)})}displayProductInfo(e){let t,r,o=document.getElementById("product-browser"),i=o.querySelector("template").content.cloneNode(!0),l=i.querySelector(".product-id"),n=i.querySelector(".product-image"),c=i.querySelector(".product-info"),s=i.querySelector(".product-name"),a=i.querySelector(".product-price"),u=i.querySelector(".product-images"),d=i.querySelector(".product-url");n.setAttribute("src",e.hero.href),n.setAttribute("alt",e.alt||e.name),n.setAttribute("width",e.width),n.setAttribute("height",e.height),l.textContent=e.id,s.textContent=e.name,c.textContent="number of images: "+e.images.length,e.price?a.textContent="regularly "+Utilities.formatPrice(e.price.regular)+", currently "+Utilities.formatPrice(e.price.selling)+", "+e.price.type:e.priceRange?a.textContent="regularly "+Utilities.formatPrice(e.priceRange.regular.low)+" to "+Utilities.formatPrice(e.priceRange.regular.high)+", currently "+Utilities.formatPrice(e.priceRange.selling.low)+" to "+Utilities.formatPrice(e.priceRange.selling.high)+", "+e.priceRange.type:a.textContent="to be announced",d.textContent=e.links.www;for(let o=0;o<e.images.length;o++)t=document.createElement("li"),r=document.createElement("img"),r.setAttribute("src",e.images[o].href),r.setAttribute("alt",e.images[o].alt||e.name),r.setAttribute("width",e.images[o].width),r.setAttribute("height",e.images[o].height),t.appendChild(r),u.appendChild(t);o.appendChild(i)}hideProductMenu(e){let t=document.getElementById("product-menu");!0===e&&this.clearProductMenu(),t.style.display="none"}async loadFeed(e){try{let t=await fetch(e);if(200===t.status)return console.log("[loadFeed] HTTP Status: 200 OK. Returning JSON."),await t.json();console.log("[loadFeed] Uh oh. The fetch request did not return with the expected HTTP status (200)."),console.log("[loadFeed] HTTP Status: "+t.status),console.log("[loadFeed] HTTP Status Text: "+t.statusText)}catch(e){console.log(e)}}showProduct(e){this.clearProductBrowser(),this.displayProductInfo(e)}showProductMenu(e){let t=document.getElementById("product-menu");0===t.querySelectorAll(".products > li").length&&this.buildProductMenu(e),t.style.display="block"}}const FEED_URL="https://bdsexton.github.io/williams-sonoma-coding-challenge/_assets/data/products.json";Utilities.isModernBrowser()?new ProductGallery(FEED_URL):alert("Sorry, but this app requires a modern web browser. Please open it in a recent version of something like Chrome, Firefox, Opera, Edge, or Safari instead.");